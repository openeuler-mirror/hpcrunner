[SERVER]
11.11.11.11

[DOWNLOAD]
augustus/3.3.3 $JARVIS_PROXY/Gaius-Augustus/Augustus/archive/refs/tags/v3.3.3.tar.gz Augustus-3.3.3.tar.gz

[DEPENDENCY]
set -x
set -e
yum install gsl* mysql-devel sqlite* suitesparse* bzip2-devel lzma xz xz-devel -y
. ${DOWNLOAD_TOOL} -u http://bioinf.uni-greifswald.de/augustus/datasets/sag178.fa.gz

module purge
module use ${JARVIS_ROOT}/software/modulefiles
./jarvis -install hpckit/25.1.0 any
module use ${JARVIS_ROOT}/software/modulefiles/hpckit25.1.0
module load bisheng/compiler4.2.0.2/bishengmodule
module load bisheng/hmpi25.1.0/release
export CC=clang CXX=clang++ FC=flang
./jarvis -install mysql/3.3.0 clang
./jarvis -install boost/1.72.0/clang clang
./jarvis -install htslib/1.11 clang
./jarvis -install samtools/1.11 clang
./jarvis -install bamtools/2.5.0 clang

tar -zxvf $JARVIS_DOWNLOAD/Augustus-3.3.3.tar.gz

[ENV]
module purge
module use ${JARVIS_ROOT}/software/modulefiles/hpckit25.1.0
module load bisheng/compiler4.2.0.2/bishengmodule
module load bisheng/hmpi25.1.0/release
module use ${JARVIS_ROOT}/software/moduledeps/bisheng4.2.0.2
module load mysql/3.3.0
module load boost-clang/1.72.0
module load htslib/1.11
module load samtools/1.11
module load bamtools/2.5.0
export PATH=${JARVIS_ROOT}/Augustus-3.3.3/bin:${PATH}

[APP]
app_name = Augustus
build_dir = ${JARVIS_ROOT}
binary_dir =
case_dir = ${JARVIS_ROOT}/Augustus-3.3.3/run

[BUILD]
rm -rf Augustus-3.3.3
tar -zxvf ${JARVIS_DOWNLOAD}/Augustus-3.3.3.tar.gz
cd Augustus-3.3.3

AUGUSTUS_PATH=$(realpath ./install)
sed -i "s|\/opt\/augustus|$AUGUSTUS_PATH|g" Makefile
sed -i -e "18s|.*|SAMTOOLS=${SAMTOOLS_PATH}/lib|" \
       -e "19s|.*|HTSLIB=${HTSLIB_PATH}/lib|" \
       ./auxprogs/bam2wig/Makefile
sed -i "s/g++/clang++/g" ./auxprogs/joingenes/Makefile ./auxprogs/utrrnaseq/Debug/makefile ./auxprogs/utrrnaseq/Debug/src/subdir.mk ./auxprogs/bam2hints/Makefile ./auxprogs/homGeneMapping/src/Makefile ./src/Makefile ./src/unittests/Makefile
sed -i "s?\/usr\/include\/boost?${BOOST_CLANG_PATH}\/include?g" ./auxprogs/utrrnaseq/Debug/src/subdir.mk

make -j VERBOSE=1 CC=clang CXX=clang++ \
      CFLAGS="-Ofast -mcpu=hip09 -g -lstdc++ -I${SAMTOOLS_PATH}/include -I${BAMTOOLS_PATH}/include/bamtools -I${BOOST_CLANG_PATH}/include -I${HTSLIB_PATH}/include -I${HTSLIB_PATH}/include/htslib -I${MYSQL_PATH}/include/mysql++ -L${BAMTOOLS_PATH}/lib64 -L${BOOST_CLANG_PATH}/lib -L${HTSLIB_PATH}/lib -L${MYSQL_PATH}/lib -L/usr/lib64/mysql" \
      CXXFLAGS="-Ofast -mcpu=hip09 -g -std=c++17 -lstdc++ -I${SAMTOOLS_PATH}/include -I${BAMTOOLS_PATH}/include/bamtools -I${BOOST_CLANG_PATH}/include -I${HTSLIB_PATH}/include -I${HTSLIB_PATH}/include/htslib -I${MYSQL_PATH}/include/mysql++ -L${BAMTOOLS_PATH}/lib64 -L${BOOST_CLANG_PATH}/lib -L${HTSLIB_PATH}/lib -L${MYSQL_PATH}/lib -L/usr/lib64/mysql"
make install

mkdir run
cd ./run
cp ${JARVIS_DOWNLOAD}/sag178.fa.gz .
gzip -d sag178.fa.gz

[CLEAN]
make clean

[RUN]
run = time -p numactl -C 0
binary = augustus sag178.fa --species=human --UTR=on
nodes = 1
