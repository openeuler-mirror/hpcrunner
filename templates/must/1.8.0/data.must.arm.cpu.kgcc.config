[SERVER]
11.11.11.11

[DOWNLOAD]
must/1.8.0   https://hpc.rwth-aachen.de/must/files/MUST-v1.8.0-rc1.tar.gz MUST-v1.8.0-rc1.tar.gz
binutils/2.40 https://mirrors.aliyun.com/gnu/binutils/binutils-2.40.tar.gz binutils-2.40.tar.gz

[DEPENDENCY]
set -e
set -x
yum install cmake make texinfo -y
module purge
./jarvis -install hpckit/2024.12.30 any
module use software/utils/hpckit/2024.12.30/HPCKit/24.12.30/modulefiles
module add gcc/compiler12.3.1/gccmodule
export CC=`which gcc`
export CXX=`which g++`
export FC=`which gfortran`
./jarvis -install openmpi/4.1.2 gcc
module use software/moduledeps/gcc12.3.1
module load openmpi/4.1.2
mkdir -p must
mkdir -p binutils
tar -xvf ${JARVIS_DOWNLOAD}/binutils-2.40.tar.gz
tar -xvf ${JARVIS_DOWNLOAD}/MUST-v1.8.0-rc1.tar.gz
cd binutils-2.40
./configure --prefix=${JARVIS_ROOT}/binutils --enable-ld=yes --with-static-standard-libraries --enable-install-libbfd CFLAGS="-fPIC" CXXFLAGS="-fPIC" FCFLAGS="-fPIC" FFLAGS="-fPIC"
make
make install
export PATH=${JARVIS_ROOT}/binutils/bin:$PATH
export LD_LIBRARY_PATH=${JARVIS_ROOT}/binutils/lib:$LD_LIBRARY_PATH
ld -version

[ENV]
module purge
module use software/utils/hpckit/2024.12.30/HPCKit/24.12.30/modulefiles
module add gcc/compiler12.3.1/gccmodule
export CC=`which gcc`
export CXX=`which g++`
export FC=`which gfortran`
module use software/moduledeps/gcc12.3.1
module load openmpi/4.1.2

[APP]
app_name = must
build_dir = ${JARVIS_ROOT}/MUST-v1.8.0-rc1/
binary_dir = ${JARVIS_ROOT}/must/bin/
case_dir = ${JARVIS_ROOT}/must/bin/

[BUILD]
sed -i 's/start = (TRANSTYPE \*)va_alist;/start = (TRANSTYPE \*)\&va_alist;/g' externals/GTI/externals/PnMPI/src/pnmpi/wrapper.c
cmake -DCMAKE_INSTALL_PREFIX=${JARVIS_ROOT}/must -DCMAKE_BUILD_TYPE=Release
make install

[CLEAN]
make clean

[RUN]
run = 
binary = mustrun -np 8 application.exe 
nodes = 1

[PERF]
perf= 
nsys=
ncu=--target-processes all
